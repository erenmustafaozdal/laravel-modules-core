var UserShow,Show={isAuthUser:!1,top_src:"",nav_src:"",options:{fileinputSrc:"#photo",formSrc:"#change-avatar-form"},form:null,init:function(){UserShow=this,this.isAuthUser=isAuthUser,this.form=$(this.options.formSrc),LMCFileinput.init(this.getFileinputInitOptions()),LMCJcrop.setupElements(),$("#destroy-avatar").on("click",function(e){var t=avatarPhotoPath+"/small.jpg",s=avatarPhotoPath+"/biggest.jpg";UserShow.changeAvatar("remove",t,s),LMCApp.startDestroyTimer(function(){$.ajax({url:destroyAvatarURL,success:function(e){return"success"===e.result?void LMCApp.getNoty({message:LMCApp.lang.admin.flash.destroy_success.message,title:LMCApp.lang.admin.flash.destroy_success.title,type:"success"}):(LMCApp.getNoty({message:LMCApp.lang.admin.flash.destroy_error.message,title:LMCApp.lang.admin.flash.destroy_error.title,type:"error"}),void UserShow.changeAvatar("add",UserShow.top_src,UserShow.nav_src))}})},function(){UserShow.changeAvatar("add",UserShow.top_src,UserShow.nav_src)})}),Validation.init({src:"#user-edit-info",isAjax:!1,validate:{rules:{first_name:{required:!0},last_name:{required:!0}},messages:userEditInfoMessages}}),Validation.init({src:"#user-change-password",isAjax:!1,validate:{rules:{password:{required:!0,minlength:6},password_confirmation:{required:!0,minlength:6,equalTo:"#password"}},messages:userChangePasswordMessages}})},changeAvatar:function(e,t,s){if(this.isAuthUser){var o=$("li.dropdown-user").find("img");this.top_src=o.prop("src"),o.prop("src",t)}var r=$("img#nav-profile-photo");this.nav_src=r.prop("src"),r.prop("src",s);var i=$("#destroy-avatar").closest("li");return"add"===e?void i.removeClass("hidden"):void i.addClass("hidden")},fileUploaded:function(e){return"success"!=e.result?void LMCApp.getNoty({message:LMCApp.lang.admin.flash.update_error.message,title:LMCApp.lang.admin.flash.update_error.title,type:"error"}):(this.changeAvatar("add",e.photos.thumbnails.small,e.photos.thumbnails.biggest),LMCFileinput.clear(),void LMCApp.getNoty({message:LMCApp.lang.admin.flash.update_success.message,title:LMCApp.lang.admin.flash.update_success.title,type:"success"}))},getFileinputInitOptions:function(){return{src:UserShow.options.fileinputSrc,formSrc:UserShow.options.formSrc,fileinput:{uploadUrl:UserShow.form.prop("action"),uploadExtraData:function(e,t){return{x:$("#x").val(),y:$("#y").val(),width:$("#width").val(),height:$("#height").val()}},otherActionButtons:'<button type="button" id="image-crop-action" class="btn btn-xs yellow btn-outline tooltips" data-toggle="modal" title="'+LMCApp.lang.admin.ops.crop+'"><i class="icon-crop"></i> </button>'},filebrowse:function(e){theLMCJcrop.jcropReset()},fileloaded:function(e,t,s,o,r){LMCApp.initTooltips(),$("#image-crop-action").on("click",function(e){theLMCJcrop.jcropPreInit(r.result).init(UserShow.getJcropInitOptions())}),theLMCJcrop.imgCropCancelBtn.on("click",function(e){theLMCJcrop.jcropReset()})},filecleared:function(e){theLMCJcrop.jcropReset()},filereset:function(e){theLMCJcrop.jcropReset()},fileuploaded:function(e,t,s,o){UserShow.fileUploaded(t.response)},filebatchuploadsuccess:function(e,t,s,o){UserShow.fileUploaded(t.response)}}},getJcropInitOptions:function(){return{jcrop:{onRelease:function(){UserShow.form.find('input[type="hidden"]').val("")}}}}};