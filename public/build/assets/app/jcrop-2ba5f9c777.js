var theLMCJcrop,LMCJcrop={elementsSrc:{jcropWrapperSrc:"#jcrop-preview",imgJcropSrc:"#img-jcrop",imgJcropPreviewSrc:"#img-jcrop-preview",imgJcropPreviewPaneWrapperSrc:"#preview-pane-wrapper",imgJcropPreviewPaneSrc:"#preview-pane",imgJcropPreviewContainerSrc:"#preview-pane .preview-container",imgCropCancelBtnSrc:"#image-crop-cancel"},jcropWrapper:null,imgJcrop:null,imgJcropPreview:null,imgJcropPreviewPaneWrapper:null,imgJcropPreviewPane:null,imgJcropPreviewContainer:null,imgCropCancelBtn:null,options:{},element:null,originalImage:null,api:null,xsize:0,ysize:0,boundx:0,boundy:0,init:function(e){theLMCJcrop||this.setupElements(),this.api&&this.api.destroy(),this.options=$.extend(!0,this.getDefaultOptions(),e),this.element=$(this.options.src),this.element.Jcrop(this.options.jcrop,function(){var e=this.getBounds();theLMCJcrop.boundx=e[0],theLMCJcrop.boundy=e[1],theLMCJcrop.imgJcropPreviewPane.appendTo(this.ui.holder),theLMCJcrop.api=this})},setupElements:function(){theLMCJcrop=this,this.jcropWrapper=$(this.elementsSrc.jcropWrapperSrc),this.imgJcrop=$(this.elementsSrc.imgJcropSrc),this.imgJcropPreview=$(this.elementsSrc.imgJcropPreviewSrc),this.imgJcropPreviewPaneWrapper=$(this.elementsSrc.imgJcropPreviewPaneWrapperSrc),this.imgJcropPreviewPane=$(this.elementsSrc.imgJcropPreviewPaneSrc),this.imgJcropPreviewContainer=$(this.elementsSrc.imgJcropPreviewContainerSrc),this.imgCropCancelBtn=$(this.elementsSrc.imgCropCancelBtnSrc),this.xsize=this.imgJcropPreviewContainer.width(),this.ysize=this.imgJcropPreviewContainer.height()},setOriginalImage:function(e){this.originalImage=new Image,this.originalImage.src=e},jcropPreInit:function(e){return this.setOriginalImage(e),this.imgJcrop.prop("src",e),this.imgJcropPreview.prop("src",e),this.jcropWrapper.removeClass("hidden"),this},jcropReset:function(){this.jcropWrapper.addClass("hidden"),this.imgJcrop.prop("src","").css({width:"",height:""}),this.imgJcropPreview.prop("src",""),this.resetFormElements(),this.api&&(this.imgJcropPreviewPane.appendTo(this.imgJcropPreviewPaneWrapper),this.api.ui.holder.remove(),this.release(),this.api.destroy())},setFormElements:function(e){$("#x").val(e.x1),$("#y").val(e.y1),$("#width").val(e.width),$("#height").val(e.height)},resetFormElements:function(){$("#x").val(""),$("#y").val(""),$("#width").val(""),$("#height").val("")},release:function(){this.api.animateTo([0,0,0,0],function(){theLMCJcrop.api.release()})},getCropSize:function(e,i,r,t){t||(i={width:this.originalImage.width,height:this.originalImage.height});var o=t?i.width/e.w:i.width/r.width,p=t?i.height/e.h:i.height/r.height;return{width:Math.round(t?o*r.width:o*e.w),height:Math.round(t?p*r.height:p*e.h),x1:Math.round(o*e.x),y1:Math.round(p*e.y),x2:Math.round(o*e.x2),y2:Math.round(p*e.y2)}},getDefaultOptions:function(){return{src:theLMCJcrop.elementsSrc.imgJcropSrc,jcrop:{bgFade:!0,bgOpacity:.2,bgColor:"white",aspectRatio:theLMCJcrop.xsize/theLMCJcrop.ysize,onChange:function(e){if(parseInt(e.w)>0){var i=theLMCJcrop.getCropSize(e,{width:theLMCJcrop.xsize,height:theLMCJcrop.ysize},{width:theLMCJcrop.boundx,height:theLMCJcrop.boundy},!0);theLMCJcrop.imgJcropPreview.css({width:i.width+"px",height:i.height+"px",marginLeft:"-"+i.x1+"px",marginTop:"-"+i.y1+"px"}),LMCJcrop.setFormElements(theLMCJcrop.getCropSize(e,{width:theLMCJcrop.xsize,height:theLMCJcrop.ysize},{width:theLMCJcrop.boundx,height:theLMCJcrop.boundy},!1))}},onSelect:function(e){LMCJcrop.setFormElements(theLMCJcrop.getCropSize(e,{width:theLMCJcrop.xsize,height:theLMCJcrop.ysize},{width:theLMCJcrop.boundx,height:theLMCJcrop.boundy},!1))}}}}};